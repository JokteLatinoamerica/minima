/**
 * @version     0.8
 * @package     Minima
 * @author      Marco Barbosa
 * @copyright   Copyright (C) 2010 Webnific. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */

/* Special thanks to these great guys at #mootools:
 * d_mitar
 * rev087
 * keeto
 * FunFactor
 * csuwldcat
 * rpflo
 * Oskar__
 * boushley
 * Garrick
 * fakedarren
 * THANK YOU for the kind help. You guys helped more than you think (m4co)
 * */

(function(){var c;var d=function(a){var b=$(a.target);var e=b.getParents();c.each(function(f){var h=f.element;if(h!=b&&!e.contains(h)){f.fn.call(h,a)}})};Element.Events.outerClick={onAdd:function(a){if(!c){document.addEvent("click",d);c=[]}c.push({element:this,fn:a})},onRemove:function(a){c=c.filter(function(b){return b.element!=this||b.fn!=a},this);if(!c.length){document.removeEvent("click",d);c=null}}}})();Element.implement("switchClass",function(e,d){var c=this.hasClass(e);this.removeClass(c?e:d).addClass(c?d:e);return this});$extend(Selectors.Pseudo,{visible:function(){if(this.getStyle("visibility")!="hidden"&&this.isVisible()&&this.isDisplayed()){return this}}});var ElementFilter=new Class({Implements:[Options,Events],options:{cache:true,caseSensitive:false,ignoreKeys:[13,27,32,37,38,39,40],matchAnywhere:true,property:"text",trigger:"keyup",onStart:$empty,onShow:$empty,onHide:$empty,onComplete:$empty},initialize:function(f,d,e){this.setOptions(e);this.observeElement=document.id(f);this.elements=$$(d);this.matches=this.elements;this.misses=[];this.listen()},listen:function(){this.observeElement.addEvent(this.options.trigger,function(b){if(this.observeElement.value.length){if(!this.options.ignoreKeys.contains(b.code)){this.fireEvent("start");this.findMatches(this.options.cache?this.matches:this.elements);this.fireEvent("complete")}}else{this.findMatches(this.elements,false)}}.bind(this))},findMatches:function(k,h){var l=this.observeElement.value;var i=this.options.matchAnywhere?l:"^"+l;var j=this.options.caseSensitive?"":"i";var n=new RegExp(i,j);var m=[];k.each(function(a){var b=(h==undefined?n.test(a.get(this.options.property)):h);if(b){if(!a.retrieve("showing")){this.fireEvent("show",[a])}m.push(a);a.store("showing",true)}else{if(a.retrieve("showing")){this.fireEvent("hide",[a])}a.store("showing",false)}return true}.bind(this));return m}});var mooPlaceholder=new Class({Implements:[Options],options:{htmlPlaceholder:"placeholder",unmoddedClass:"unchanged",parentNode:document,defaultSelector:"input[placeholder]"},initialize:function(b){this.setOptions(b);this.nativeSupport="placeholder" in document.createElement("input")},attachToElements:function(d){var c=this.options.parentNode.getElements(d||this.options.defaultSelector);if(c.length){c.each(function(a){this.attachEvents(a)},this)}},attachEvents:function(d,c){var c=c||d.get(this.options.htmlPlaceholder);if(this.nativeSupport||!$(d)||!c||!c.length){return}d.set("value",c).store("placeholder",c);if(this.options.unmoddedClass){d.addClass(this.options.unmoddedClass)}d.addEvents({change:function(){var b=d.get("value").trim(),a=d.retrieve("placeholder");if(b!=a){d.removeClass(this.options.unmoddedClass).removeEvents("change")}}.bind(this),focus:function(){var b=d.get("value").trim(),a=d.retrieve("placeholder");if(b==a){d.set("value","").removeClass(this.options.unmoddedClass)}}.bind(this),blur:function(){var b=d.get("value").trim(),a=d.retrieve("placeholder");if(b==a||b==""){d.set("value",a).addClass(this.options.unmoddedClass)}}.bind(this)})}});window.addEvent("load",function(){});window.addEvent("domready",function(){(function(W){this.IPhoneCheckboxes=new Class({Implements:[Options],options:{checkedLabel:"ON",uncheckedLabel:"OFF",background:"#fff",containerClass:"iPhoneCheckContainer",labelOnClass:"iPhoneCheckLabelOn",labelOffClass:"iPhoneCheckLabelOff",handleClass:"iPhoneCheckHandle",handleBGClass:"iPhoneCheckHandleBG",handleSliderClass:"iPhoneCheckHandleSlider",elements:"input[type=checkbox].check"},initialize:function(X){this.setOptions(X);this.elements=$$(this.options.elements);this.elements.each(function(Y){this.observe(Y)},this)},observe:function(ac){ac.set("opacity",0);var ad=new Element("div",{"class":this.options.containerClass}).inject(ac.getParent());ac.inject(ad);var aa=new Element("div",{"class":this.options.handleClass}).inject(ad);var ae=new Element("div",{"class":this.options.handleBGClass,style:this.options.background}).inject(aa);var Y=new Element("div",{"class":this.options.handleSliderClass}).inject(aa);var X=new Element("label",{"class":this.options.labelOffClass,text:this.options.uncheckedLabel}).inject(ad);var ab=new Element("label",{"class":this.options.labelOnClass,text:this.options.checkedLabel}).inject(ad);var Z=ad.getSize().x-39;ac.offFx=new Fx.Tween(X,{property:"opacity",duration:200});ac.onFx=new Fx.Tween(ab,{property:"opacity",duration:200});ad.addEvent("mouseup",function(){var af=!ac.checked;var ah=(af?Z:0);var ag=(af?34:0);ae.hide();new Fx.Tween(aa,{duration:100,property:"left",onComplete:function(){ae.setStyle("left",ag).show()}}).start(ah);if(af){ac.offFx.start(0);ac.onFx.start(1)}else{ac.offFx.start(1);ac.onFx.start(0)}ac.set("checked",af)});if(ac.checked){X.set("opacity",0);ab.set("opacity",1);aa.setStyle("left",Z);ae.setStyle("left",34)}else{ab.set("opacity",0);ae.setStyle("left",0)}}})})(document.id);var u=MooTools.lang.get("Minima");var c=$$(".toolbar-list li a");var q=$("toolbar");var i=new Array();var j=new Array();if(c.length){c.each(function(W){if(W.get("onclick")!=null&&W.get("onclick").contains("if")){i.push(W.getParent("li"))}else{if(W.get("class")!="divider"){j.push(W.getParent("li"))}}})}if(i.length){var z=new Element("ul",{id:"actions"}).hide();i=i.sort(function(X,W){if(X.get("text").toLowerCase()<W.get("text").toLowerCase()){return -1}if(X.get("text").toLowerCase()==W.get("text").toLowerCase()){return 0}return 1});i.each(function(W,X){z.grab(W)});var R=new Element("li",{id:"bulkActions",events:{click:function(W){z.toggle();$$("#bulkActions > a:first-child").switchClass("active","inactive");this.switchClass("active","inactive")},outerClick:function(){z.hide();$$("#bulkActions > a:first-child").set("class","inactive")}}});var K=new Element("a",{html:u.actionBtn});var h=new Element("span",{"class":"arrow"});var b=($("toolbar-new"))?"ul > li#toolbar-new":"ul > li";R.inject($("toolbar").getElement(b),"after");$("bulkActions").grab(K);K.grab(h);$("bulkActions").grab(z)}if(q){q.show()}$(document.body).addClass("ready");$(document.body).removeClass("no-js");var T=$$(".adminlist");if(T.length){T.set("id","adminlist")}if($("submenu")){$("submenu").addClass("minimaTabs")}var J=$("system-message");if(J&&J.getElement("ul li:last-child")){var a=new Element("a",{href:"#",id:"hide-system-message",html:"hide",events:{click:function(W){J.dissolve({duration:"short"})}}});J.show().getElement("ul li:last-child").adopt(a)}if($("rules")){$$(".jpane-toggler").addEvent("click",function(){var W=this.getNext(".jpane-slider").getElement("caption");if(W){W.set("tween",{duration:"2000"}).highlight("#ffd")}})}var D=$("submenu");var p=$("item-form");if((D&&D.hasClass("out"))||(D&&$("item-form"))){if(p){p.getChildren("div").addClass("hide")}D.inject($("content"),"top")}if(D&&$("item-form")){var n=$$(".minimaTabs a"),F=p.getChildren("div").addClass("hide");F[0].removeClass("hide");n.each(function(X,W){X.addEvents({click:function(Y){Y.stop();n.removeClass("active");this.addClass("active");F.addClass("hide");F[W].removeClass("hide")}})});var E=$$("#advanced-tabs a"),s=$("tabs").getChildren(".panelform").addClass("hide");s[0].removeClass("hide");E.each(function(X,W){X.addEvents({click:function(Y){Y.stop();E.removeClass("active");this.addClass("active");s.addClass("hide");s[W].removeClass("hide")}})})}if(!$("filter-bar")&&$$(".adminlist")){$$(".adminlist").addClass("padTop")}if($$(".adminlist").length){var A=$$("input[name=checkall-toggle]");A.addEvent("click",function(){var W=$$(".adminlist tbody tr");W.toggleClass("selected")});$$(".adminlist tbody tr input[type=checkbox]").each(function(W){var X=W.getParent("tr");var Y=$$("input[name=boxchecked]");W.addEvent("click",function(Z){Z&&Z.stopPropagation();if(W.checked){X.addClass("selected")}else{X.removeClass("selected")}});X.addEvent("click",function(){if(W.checked){W.set("checked",false);Y.set("value",0)}else{W.set("checked",true);Y.set("value",1)}W.fireEvent("click")})});var O=$("adminlist").getElements("th img");O.getParent("th").addClass("active")}if($("jform_title")){if($("jform_title").get("value")!=""){$$(".pagetitle h2").set("html",$("jform_title").get("value"))}$("jform_title").addEvent("keyup",function(W){if($("jform_title").get("value")!=""){$$(".pagetitle h2").set("html",this.get("value"))}$("jform_alias").set("value",this.get("value").standardize().replace(/\s+/g,"-").replace(/[^-\w]+/g,"").toLowerCase())})}var H=$("filter-bar");if(H){var P={"true":u.closeFilter,"false":u.showFilter};var o=new Fx.Slide(H).hide();var y=new Element("a",{href:"#",id:"open-filter",html:u.closeFilter,events:{click:function(W){W.stop();o.toggle();this.toggleClass("active")}}});var m=false;var e="";H.getElements("input, select").each(function(W){var X=W.get("value");if(X&&X!=0&&X!="*"){m=true;e+=(W.get("tag").toLowerCase()=="select")?W.getElement("option:selected").get("html").toLowerCase()+" ":e+=X.toLowerCase()+" "}});if(m){o.show()}y.set("html",P[o.open]);var v=$$(".pagetitle").getElement("h2");if(e){v.set("html",v.get("html")+"<em>( "+e+")</em>")}o.addEvent("complete",function(){y.set("html",P[o.open])});$$(".pagetitle").grab(y);H.show()}var Q=$("panel-wrapper");if(Q){var l={"true":"active","false":"inactive"};Fx.Slide.Mine=new Class({Extends:Fx.Slide,initialize:function(X,W){this.parent(X,W);this.wrapper=this.element.getParent();this.wrapper.setStyles({})},onStart:function(){}});var r=new Fx.Slide.Mine(Q,{mode:"vertical",transition:Fx.Transitions.Pow.easeOut}).hide();var C=$("prev");var f=$("next");var x=$("panel-list");if(f){var I=0,G=900;var S=new Fx.Tween(x,{duration:500,transition:"back:in:out"});var B=x.getChildren("li").length;x.setStyle("width",Math.round(B/9)*900);var d=(G*-(Math.ceil(B/9)))+900;var g=$("panel-pagination");var N=function(){if(I==0){C.hide()}else{if(I==d){f.hide()}}};N();C.addEvent("click",function(){if(I<0){f.show();I+=G;S.pause();S.start("margin-left",I);g.getFirst(".current").removeClass("current").getPrevious("li").addClass("current");N()}});f.addEvent("click",function(){if(I>d){C.show();I-=G;S.pause();S.start("margin-left",I);g.getFirst(".current").removeClass("current").getNext("li").addClass("current");N()}});g.getChildren("li").addEvent("click",function(){if(I<0){f.show();I+=G;S.pause();S.start("margin-left",I);g.getFirst(".current").removeClass("current").getPrevious("li").addClass("current");N()}else{if(I>d){C.show();I-=G;S.pause();S.start("margin-left",I);g.getFirst(".current").removeClass("current").getNext("li").addClass("current");N()}}})}var M=$("search-term");if(M){var V=new ElementFilter("search-term","#panel-list li a",{trigger:"keyup",cache:false,onShow:function(W){W.show()},onHide:function(W){W.hide()},onComplete:function(W){console.log(W)}})}var U=$("more");var w=$("list-content");var k=$("panel-tab");var t=$("list-wrapper");if(!U.hasClass("disabled")&&!k.hasClass("disabled")){k.addEvents({click:function(){r.toggle()},outerClick:function(){}});r.addEvent("complete",function(){k.set("class",l[r.open])});U.addEvent("click",function(){this.switchClass("active","inactive");w.toggle()});var L=function(){U.set("class","inactive");t.removeClass("active");w.hide()};t.addEvent("outerClick",function(){L()});w.getElements("a").addEvent("click",function(){L()});$$("#panel-list li").addEvent("click",function(){r.toggle()})}}});
